function gencode(app)

disp("generate code...");
if ~exist(char("app"), 'dir')
    mkdir(char("app"));
else
   if exist("app/opuApp.a", 'file') == 2 
       delete('app/opuApp.a');
   end
   if exist("app/cpuApp.a", 'file') == 2 
       delete('app/cpuApp.a');       
   end   
   if exist("app/gpuApp.a", 'file') == 2 
       delete('app/gpuApp.a');
   end   
end

[xij, xik, xil, xi, xj, xk, xl, qi, qj, qk, ql, ti, tj, tk, tl, ai, aj, ak, al] = syminit(app);
potentialfile = str2func(app.potentialfile);
pot = potentialfile();

potform = 1;
filename = "Singlea";
mu = sym('mu',[app.ncmu1a 1]);
if isfield(pot, filename)    
    u = pot.Singlea(xi, qi, ti, mu); 
    genpotential(filename, u, xij, xik, xil, xi, xj, xk, xl, qi, qj, qk, ql, ti, tj, tk, tl, ai, aj, ak, al, mu, potform);    
else
    nopotential(filename, [], xij, xik, xil, xi, xj, xk, xl, qi, qj, qk, ql, ti, tj, tk, tl, ai, aj, ak, al, mu, potform);    
end

filename = "Singleb";
mu = sym('mu',[app.ncmu1b 1]);
if isfield(pot, filename)        
    u = pot.Singleb(xi, qi, ti, mu);    
    genpotential(filename, u, xij, xik, xil, xi, xj, xk, xl, qi, qj, qk, ql, ti, tj, tk, tl, ai, aj, ak, al, mu, potform);    
else
    nopotential(filename, [], xij, xik, xil, xi, xj, xk, xl, qi, qj, qk, ql, ti, tj, tk, tl, ai, aj, ak, al, mu, potform);    
end

potform = 2;
filename = "Paira";
mu = sym('mu',[app.ncmu2a 1]);
if isfield(pot, filename)    
    u = pot.Paira(xij, qi, qj, ti, tj, mu);
    genpotential(filename, u, xij, xik, xil, xi, xj, xk, xl, qi, qj, qk, ql, ti, tj, tk, tl, ai, aj, ak, al, mu, potform);    
else
    nopotential(filename, [], xij, xik, xil, xi, xj, xk, xl, qi, qj, qk, ql, ti, tj, tk, tl, ai, aj, ak, al, mu, potform);    
end

filename = "Pairb";
mu = sym('mu',[app.ncmu2b 1]);
if isfield(pot, filename)    
    u = pot.Pairb(xij, qi, qj, ti, tj, mu);
    genpotential(filename, u, xij, xik, xil, xi, xj, xk, xl, qi, qj, qk, ql, ti, tj, tk, tl, ai, aj, ak, al, mu, potform);    
else
    nopotential(filename, [], xij, xik, xil, xi, xj, xk, xl, qi, qj, qk, ql, ti, tj, tk, tl, ai, aj, ak, al, mu, potform);    
end

filename = "Pairc";
mu = sym('mu',[app.ncmu2c 1]);
rho = sym('rho',[1 1]);
if isfield(pot, filename)    
    u = pot.Pairc(xij, qi, qj, ti, tj, rho, mu);
    genbo2(filename, u, xij, qi, qj, ti, tj, ai, aj, rho, mu, natomtype);    
else
    ifile = 0;
    gen = 0;    
    [stropu, strcpu, strgpu] = genpair(filename, [], xij, qi, qj, ti, tj, ai, aj, mu, gen, ifile);
    [tmpopu, tmpcpu, tmpgpu] = gendensity("PaircDensity", [], mu, mu, gen, ifile);    
    stropu = stropu  + "\n" + tmpopu + "\n";
    strcpu = strcpu  + "\n" + tmpcpu + "\n";
    strgpu = strgpu  + "\n" + tmpgpu + "\n";    
    cppfiles(filename, stropu, strcpu, strgpu, 1);
end

potform = 3;
filename = "Tripleta";
mu = sym('mu',[app.ncmu3a 1]);
if isfield(pot, filename)    
    u = pot.Tripleta(xij, xik, qi, qj, qk, ti, tj, tk, mu);
    genpotential(filename, u, xij, xik, xil, xi, xj, xk, xl, qi, qj, qk, ql, ti, tj, tk, tl, ai, aj, ak, al, mu, potform);    
else
    nopotential(filename, [], xij, xik, xil, xi, xj, xk, xl, qi, qj, qk, ql, ti, tj, tk, tl, ai, aj, ak, al, mu, potform);    
end

filename = "Tripletb";
mu = sym('mu',[app.ncmu3b 1]);
if isfield(pot, filename)    
    u = pot.Tripletb(xij, xik, qi, qj, qk, ti, tj, tk, mu);
    genpotential(filename, u, xij, xik, xil, xi, xj, xk, xl, qi, qj, qk, ql, ti, tj, tk, tl, ai, aj, ak, al, mu, potform);    
else
    nopotential(filename, [], xij, xik, xil, xi, xj, xk, xl, qi, qj, qk, ql, ti, tj, tk, tl, ai, aj, ak, al, mu, potform);    
end

filename = "Tripletc";
mu = sym('mu',[app.ncmu3c 1]);
rho = sym('rho',[1 1]);
if isfield(pot, filename)    
    u = pot.Tripletc(xij, xik, qi, qj, qk, ti, tj, tk, rho, mu);
    genpotential(filename, u, xij, xik, xil, xi, xj, xk, xl, qi, qj, qk, ql, ti, tj, tk, tl, ai, aj, ak, al, mu, potform);    
else
    ifile = 0;
    gen = 0;
    fp = "TripletcPair";
    fn = "TripletcDensity";    
    [stropu, strcpu, strgpu] = gentriplet(filename, [], xij, xik, qi, qj, qk, ti, tj, tk, ai, aj, ak, mu, gen, ifile);
    [tmqopu, tmqcpu, tmqgpu] = genpair(fp, [], xij, qi, qj, ti, tj, ai, aj, mu, gen, ifile);
    [tmpopu, tmpcpu, tmpgpu] = gendensity(fn, [], mu, mu, gen, ifile);    
    stropu = stropu  + "\n" + tmqopu + "\n" + tmpopu + "\n";
    strcpu = strcpu  + "\n" + tmqcpu + "\n" + tmpcpu + "\n";
    strgpu = strgpu  + "\n" + tmqgpu + "\n" + tmpgpu + "\n";    
    cppfiles(filename, stropu, strcpu, strgpu, 1);    
end

potform = 4;
filename = "Quadrupleta";
mu = sym('mu',[app.ncmu4a 1]);
if isfield(pot, filename)    
    u = pot.Quadrupleta(xij, xik, xil, qi, qj, qk, ql, ti, tj, tk, tl, mu);
    genpotential(filename, u, xij, xik, xil, xi, xj, xk, xl, qi, qj, qk, ql, ti, tj, tk, tl, ai, aj, ak, al, mu, potform);    
else
    nopotential(filename, [], xij, xik, xil, xi, xj, xk, xl, qi, qj, qk, ql, ti, tj, tk, tl, ai, aj, ak, al, mu, potform);    
end

filename = "Quadrupletb";
mu = sym('mu',[app.ncmu4b 1]);
if isfield(pot, filename)    
    u = pot.Quadrupletb(xij, xik, xil, qi, qj, qk, ql, ti, tj, tk, tl, mu);
    genpotential(filename, u, xij, xik, xil, xi, xj, xk, xl, qi, qj, qk, ql, ti, tj, tk, tl, ai, aj, ak, al, mu, potform);    
else
    nopotential(filename, [], xij, xik, xil, xi, xj, xk, xl, qi, qj, qk, ql, ti, tj, tk, tl, ai, aj, ak, al, mu, potform);    
end

end
