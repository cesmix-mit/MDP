function writeapp(app,filename)

%disp('Writing app into a binary file...'); 

ndims = zeros(20,1);
ndims(1) = app.dim;
ndims(2) = app.L;
ndims(3) = app.K;
ndims(4) = app.ntimesteps;
ndims(5) = app.nab;
ndims(6) = app.mpiprocs;  
ndims(7) = app.backend;
ndims(8) = app.nconfigs;
ndims(9) = app.natomtype;
ndims(10) = app.nmoletype; 

nsize = zeros(50,1);
nsize(1) = length(ndims(:));
nsize(2) = length(app.flag(:));  
nsize(3) = length(app.bcs(:)); 
nsize(4) = length(app.pbc(:)); 
nsize(5) = length(app.atommasses(:));
nsize(6) = length(app.atomcharges(:));
nsize(7) = length(app.atomnumbers(:));
nsize(8) = length(app.simparam(:)); 
nsize(9) = length(app.eta(:));
nsize(10) = length(app.kappa(:));
nsize(11) = length(app.muml(:)); 
nsize(12) = length(app.mu1a(:));
nsize(13) = length(app.mu1b(:));
nsize(14) = length(app.mu2a(:));
nsize(15) = length(app.mu2b(:));
nsize(16) = length(app.mu2c(:));
nsize(17) = length(app.mu3a(:));
nsize(18) = length(app.mu3b(:));
nsize(19) = length(app.mu3c(:));
nsize(20) = length(app.mu4a(:));
nsize(21) = length(app.mu4b(:));
nsize(22) = length(app.pot1a(:));
nsize(23) = length(app.pot1b(:));
nsize(24) = length(app.pot2a(:));
nsize(25) = length(app.pot2b(:));
nsize(26) = length(app.pot2c(:));
nsize(27) = length(app.pot3a(:));
nsize(28) = length(app.pot3b(:));
nsize(29) = length(app.pot3c(:));
nsize(30) = length(app.pot4a(:));
nsize(31) = length(app.pot4b(:));
nsize(32) = length(app.rcutml(:));
nsize(33) = length(app.rcut2a(:));
nsize(34) = length(app.rcut2b(:));
nsize(35) = length(app.rcut2c(:));
nsize(36) = length(app.rcut3a(:));
nsize(37) = length(app.rcut3b(:));
nsize(38) = length(app.rcut3c(:));
nsize(39) = length(app.rcut4a(:));
nsize(40) = length(app.rcut4b(:));
nsize(41) = length(app.rcutsqmax(:));
nsize(42) = length(app.atom1b(:));
nsize(43) = length(app.atom2b(:));
nsize(44) = length(app.atom2c(:));
nsize(45) = length(app.atom3b(:));
nsize(46) = length(app.atom3c(:));
nsize(47) = length(app.atom4b(:));
nsize(48) = length(app.solparam(:)); 
nsize(49) = length(app.boxoffset(:)); 

endian = 'native';
app.nsize = nsize;
app.ndims = ndims;
fileID = fopen(filename,'w');
fwrite(fileID,length(app.nsize(:)),'double',endian);
fwrite(fileID,app.nsize(:),'double',endian);
fwrite(fileID,app.ndims(:),'double',endian);
fwrite(fileID,app.flag(:),'double',endian);
fwrite(fileID,app.bcs(:),'double',endian);
fwrite(fileID,app.pbc(:),'double',endian);
fwrite(fileID,app.atommasses(:),'double',endian);
fwrite(fileID,app.atomcharges(:),'double',endian);
fwrite(fileID,app.atomnumbers(:),'double',endian);
fwrite(fileID,app.simparam(:),'double',endian);
fwrite(fileID,app.eta(:),'double',endian);
fwrite(fileID,app.kappa(:),'double',endian);
fwrite(fileID,app.muml(:),'double',endian);
fwrite(fileID,app.mu1a(:),'double',endian);
fwrite(fileID,app.mu1b(:),'double',endian);
fwrite(fileID,app.mu2a(:),'double',endian);
fwrite(fileID,app.mu2b(:),'double',endian);
fwrite(fileID,app.mu2c(:),'double',endian);
fwrite(fileID,app.mu3a(:),'double',endian);
fwrite(fileID,app.mu3b(:),'double',endian);
fwrite(fileID,app.mu3c(:),'double',endian);
fwrite(fileID,app.mu4a(:),'double',endian);
fwrite(fileID,app.mu4b(:),'double',endian);
fwrite(fileID,app.pot1a(:),'double',endian);
fwrite(fileID,app.pot1b(:),'double',endian);
fwrite(fileID,app.pot2a(:),'double',endian);
fwrite(fileID,app.pot2b(:),'double',endian);
fwrite(fileID,app.pot2c(:),'double',endian);
fwrite(fileID,app.pot3a(:),'double',endian);
fwrite(fileID,app.pot3b(:),'double',endian);
fwrite(fileID,app.pot3c(:),'double',endian);
fwrite(fileID,app.pot4a(:),'double',endian);
fwrite(fileID,app.pot4b(:),'double',endian);
fwrite(fileID,app.rcutml(:).^2,'double',endian);
fwrite(fileID,app.rcut2a(:).^2,'double',endian);
fwrite(fileID,app.rcut2b(:).^2,'double',endian);
fwrite(fileID,app.rcut2c(:).^2,'double',endian);
fwrite(fileID,app.rcut3a(:).^2,'double',endian);
fwrite(fileID,app.rcut3b(:).^2,'double',endian);
fwrite(fileID,app.rcut3c(:).^2,'double',endian);
fwrite(fileID,app.rcut4a(:).^2,'double',endian);
fwrite(fileID,app.rcut4b(:).^2,'double',endian);
fwrite(fileID,app.rcutsqmax(:),'double',endian);
fwrite(fileID,app.atom1b(:),'double',endian);
fwrite(fileID,app.atom2b(:),'double',endian);
fwrite(fileID,app.atom2c(:),'double',endian);
fwrite(fileID,app.atom3b(:),'double',endian);
fwrite(fileID,app.atom3c(:),'double',endian);
fwrite(fileID,app.atom4b(:),'double',endian);
fwrite(fileID,app.solparam(:),'double',endian);
fwrite(fileID,app.boxoffse(:),'double',endian);

fclose(fileID);


